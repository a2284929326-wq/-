<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>给黄海玲的圣诞礼物</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }
        #loader { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; justify-content: center; align-items: center; color: #ff9d00; transition: opacity 1s; }
        #blessing { position: fixed; top: 15%; width: 100%; text-align: center; color: #ff9d00; font-size: 30px; font-weight: bold; text-shadow: 0 0 20px #ff9d00; z-index: 5; opacity: 0; transition: 1.2s; pointer-events: none; }
        #photo-container { position: fixed; top: 52%; left: 50%; transform: translate(-50%, -50%) scale(0.5); width: 240px; height: 240px; border-radius: 50%; border: 3px solid #ff8c00; box-shadow: 0 0 50px rgba(255,140,0,0.6); overflow: hidden; z-index: 4; display: none; opacity: 0; transition: 1s ease; }
        #user-photo { width: 100%; height: 100%; object-fit: cover; }
        #hint { position: fixed; bottom: 30px; width: 100%; text-align: center; color: rgba(255,140,0,0.5); font-size: 13px; z-index: 10; letter-spacing: 2px; }
    </style>
    <script type="importmap"> { "imports": { "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js" } } </script>
</head>
<body>
<div id="loader">正在开启圣诞魔法...</div>
<div id="blessing">黄海玲 圣诞节快乐</div>
<div id="photo-container"><img id="user-photo" src="" alt=""></div>
<div id="hint">点击屏幕 • 开启惊喜</div>

<script type="module">
    import * as THREE from 'three';
    let scene, camera, renderer, mainGroup, particles = [];
    let STATE = { MODE: 'TREE' };

    // 自动匹配你刚才上传的照片文件名
    const PHOTO_NAME = "9E4B5714F4C0D61A4BFB9C53E2AC63DE.png.jpg"; 

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 1000);
        camera.position.z = 55;
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);
        mainGroup = new THREE.Group();
        scene.add(mainGroup);

        // 创建2500个高浓度金色粒子
        for(let i=0; i<2500; i++) {
            const mat = new THREE.PointsMaterial({ size: 0.5, color: i % 10 === 0 ? 0xffffff : 0xff9900, transparent: true, blending: THREE.AdditiveBlending });
            const p = new THREE.Points(new THREE.BufferGeometry(), mat);
            p.geometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(3), 3));
            const t = i / 2500;
            const angle = t * Math.PI * 60;
            const r = 15 * (1 - t);
            p.userData.treePos = new THREE.Vector3(Math.cos(angle)*r, t*36 - 18, Math.sin(angle)*r);
            p.userData.scatterPos = new THREE.Vector3().setFromSphericalCoords(35, Math.random()*Math.PI, Math.random()*Math.PI*2);
            p.position.copy(p.userData.treePos);
            mainGroup.add(p);
            particles.push(p);
        }

        // 预加载照片
        document.getElementById('user-photo').src = PHOTO_NAME;

        window.addEventListener('click', () => {
            STATE.MODE = STATE.MODE === 'TREE' ? 'SCATTER' : 'TREE';
            const isScatter = STATE.MODE === 'SCATTER';
            document.getElementById('blessing').style.opacity = isScatter ? '1' : '0';
            document.getElementById('hint').style.opacity = isScatter ? '0' : '1';
            const pc = document.getElementById('photo-container');
            if(isScatter) { 
                pc.style.display = 'block'; 
                setTimeout(() => { pc.style.opacity = '1'; pc.style.transform = 'translate(-50%, -50%) scale(1)'; }, 20); 
            } else { 
                pc.style.opacity = '0'; 
                pc.style.transform = 'translate(-50%, -50%) scale(0.5)';
                setTimeout(() => { if(STATE.MODE==='TREE') pc.style.display = 'none'; }, 800); 
            }
        });

        document.getElementById('loader').style.opacity = '0';
        setTimeout(() => document.getElementById('loader').remove(), 1000);
        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        particles.forEach(p => {
            const target = STATE.MODE === 'TREE' ? p.userData.treePos : p.userData.scatterPos;
            p.position.lerp(target, 0.05);
        });
        mainGroup.rotation.y += 0.004;
        renderer.render(scene, camera);
    }
    init();
</script>
</body>
</html>
